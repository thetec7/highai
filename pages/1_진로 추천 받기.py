from openai import OpenAI
import streamlit as st

API_KEY = st.secrets["openai_api_key"]

with st.sidebar:
    st.subheader("HighAI")

st.set_page_config(
    page_title="HighAI",
    page_icon="ğŸ“",
    layout="centered"
)

st.header("ğŸ’¬ ì§„ë¡œ ì¶”ì²œ ë°›ê¸°")
st.caption("ğŸ˜€ **ì‚¬ìš© ë°©ë²•:** ì±„íŒ…ì°½ì— ë‹¹ì‹ ì˜ **ê´€ì‹¬ì‚¬**, **ì„±í–¥**, **ì¢‹ì•„í•˜ëŠ” í™œë™** ë“±ì„ ììœ ë¡­ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.  \n ğŸ˜ **ì‘ì„± ì˜ˆì‹œ:**  ë¬¼ë¦¬ê°€ ì •ë§ ì¢‹ì•„ìš” ğŸ’¡ MBTIëŠ” ENFPì˜ˆìš”!ğŸŒŸ ë§Œë“œëŠ” ê±¸ ì¢‹ì•„í•´ìš”ğŸ”¨")
if "messages" not in st.session_state:
    st.session_state["messages"] = [{"role": "assistant", "content": "ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” ê³ ë“±í•™ìƒ ì—¬ëŸ¬ë¶„ì˜ ì§„ë¡œ ê³ ë¯¼ì„ í•¨ê»˜ ë‚˜ëˆ„ê³ , ì—¬ëŸ¬ë¶„ì˜ ê¿ˆì„ ì°¾ì•„ê°€ëŠ” ë° ë„ì›€ì„ ë“œë¦¬ëŠ” ì§„ë¡œ ìƒë‹´ ì±—ë´‡ì…ë‹ˆë‹¤."}]

for msg in st.session_state.messages:
    st.chat_message(msg["role"]).write(msg["content"])

if prompt := st.chat_input("ì—¬ê¸°ì— ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."): 

    client = OpenAI(api_key=API_KEY)
    st.session_state.messages.append({"role": "user", "content": prompt})
    st.chat_message("user").write(prompt)
    
    system_prompt = """
    ë‹¹ì‹ ì€ ê³ ë“±í•™ìƒì˜ ì§„ë¡œë¥¼ ì „ë¬¸ì ìœ¼ë¡œ ìƒë‹´í•´ì£¼ëŠ” AIì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ê´€ì‹¬ ìˆëŠ” ë¶„ì•¼ë‚˜ í‚¤ì›Œë“œë¥¼ ì œì‹œí•˜ë©´, ì´ì— ê¸°ë°˜í•˜ì—¬ ë‹¤ìŒ ì •ë³´ë¥¼ ë”°ëœ»í•˜ê³  ì¹œì ˆí•œ ë§íˆ¬ë¡œ êµ¬ì²´ì ìœ¼ë¡œ ë‹¨ê³„ë³„ë¡œ ì•ˆë‚´í•©ë‹ˆë‹¤:
    1.  **ê´€ë ¨ ì§ì—… ì„¤ëª…**: í•™ìƒì´ ê´€ì‹¬ì„ ë³´ì¸ ì§ì—…ì´ë‚˜ ë¶„ì•¼ì— ëŒ€í•´ ì¶”ê°€ ì§ˆë¬¸ì„ ì´ì–´ê°€ë©° ì§„ë¡œë¥¼ êµ¬ì²´í™”í•˜ë„ë¡ ë•ìŠµë‹ˆë‹¤.
    2.  **ê´€ë ¨ í•™ê³¼ ë° ëŒ€í•™, ê³„ì—´ ì•ˆë‚´**: ëŒ€í•œë¯¼êµ­ ì „ì²´ ëŒ€í•™ì„ íƒìƒ‰í•˜ì—¬ ì§ì—…ê³¼ ê´€ë ¨ëœ í•™ê³¼, ê³„ì—´ì„ 10ê°œ ì´ìƒ ì„¤ëª…í•©ë‹ˆë‹¤.

    **ì‘ë‹µ ì§€ì¹¨**:
    * í•™ìƒ ëˆˆë†’ì´ì— ë§ê²Œ ì‰¬ìš´ í‘œí˜„ì„ ì‚¬ìš©í•˜ë©°, ê°€ëŠ¥í•œ í•œ ì‹¤ì§ˆì ì´ê³  êµ¬ì²´ì ì¸ ì¡°ì–¸ì„ í¬í•¨í•©ë‹ˆë‹¤.
    * ì²˜ìŒ ì§ì—…, ê³„ì—´ì„ ì¶”ì²œí•  ë•Œì—ëŠ” ìµœëŒ€í•œ ë‹¤ì–‘í•œ ì§ì—…(7ê°œ ì´ìƒ)ì„ ì¶”ì²œí•˜ê³ , ì–´ë–¤ ì§ì—…ì¸ì§€ë„ ê°„ë‹¨íˆ ì†Œê°œí•©ë‹ˆë‹¤.
    * ëŒ€í•™êµë¥¼ ì¶”ì²œí•  ë•Œì—ëŠ” ìˆ˜ë„ê¶Œ ëŒ€í•™, ì§€ì—­ ê±°ì  êµ­ë¦½ëŒ€, êµ­ë¦½ëŒ€ ìˆœì„œë¡œ ì¶”ì²œí•©ë‹ˆë‹¤.
    * í•­ìƒ ë”°ëœ»í•˜ê³  ì¹œì ˆí•œ ë§íˆ¬ë¥¼ ìœ ì§€í•˜ë©°, í•˜ìœ„ëª©ë¡ì„ ìì œí•˜ê³  ì´ëª¨ì§€ë¥¼ ì ê·¹ì ìœ¼ë¡œ í™œìš©í•˜ì—¬ ê°€ë…ì„±ì„ ë†’ì…ë‹ˆë‹¤.
    * ë‹¨ê³„ë¥¼ êµ¬ë¶„í•˜ì—¬ ìˆœì°¨ì ìœ¼ë¡œ ì •ë³´ë¥¼ ì œê³µí•˜ê³ , ë‹¤ìŒ ë‹¨ê³„ë¡œ ë‚˜ì•„ê°ˆ ìˆ˜ ìˆë„ë¡ ìœ ë„ ì§ˆë¬¸ì„ í•©ë‹ˆë‹¤.
    """
    messages_with_system = [{"role": "system", "content": system_prompt}] + st.session_state.messages

    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=messages_with_system
    )
    msg = response.choices[0].message.content
    st.session_state.messages.append({"role": "assistant", "content": msg})
    st.chat_message("assistant").write(msg)